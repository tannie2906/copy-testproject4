<!-- Preview File Sharing -->
<div *ngIf="loading" class="loading-spinner">Loading...</div>

<div *ngIf="!loading" class="preview-container">
  <h2>{{ fileName }}</h2>
  <p>Type: {{ fileType }}</p>
  <p>Size: {{ fileSize }}</p>

  <!-- Image Preview -->
  <div *ngIf="fileType.startsWith('image/')">
    <img [src]="previewUrl" alt="File Preview" />
  </div>

  <!-- PDF Preview -->
  <div *ngIf="fileType === 'application/pdf'">
    <iframe [src]="sanitizePdfUrl(previewUrl)" class="preview-frame"></iframe>
  </div>

  <!-- Secure Preview for PDF -->
  <div class="preview-container" oncontextmenu="return false;">
    <iframe [src]="sanitizePdfUrl(previewUrl)" class="file-preview"></iframe>
  </div>

  <!-- Watermark for PDFs -->
  <div class="preview-container">
    <div class="watermark">{{ getUserEmail() }}</div>
    <iframe [src]="sanitizePdfUrl(previewUrl)" class="file-preview"></iframe>
  </div>

  <!-- DOCX Preview -->
  <div *ngIf="fileType === 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'">
    <div class="docx-preview">
      <p>{{ extractedText }}</p>
    </div>
  </div>

  <!-- Unsupported File -->
  <div *ngIf="!fileType.startsWith('image/') && fileType !== 'application/pdf' && fileType !== 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'">
    <p>Preview not available for this file type.</p>
  </div>

  <!-- ðŸ”¹ Universal Download Button -->
  <a *ngIf="canDownload" [href]="getDownloadUrl()" download="{{ fileName }}" class="download-btn">
    Download File
  </a>

  <p *ngIf="!canDownload" class="warning-text">
    Download is disabled for this file.
  </p>

  <!-- Watermark -->
  <div class="watermark">{{ getUserEmail() }}</div>
</div>